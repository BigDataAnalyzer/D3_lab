<!DOCTYPE html>
<html>
    <head>
        <title> D3 Assignment jds797, blg332 and gm1908</title>
        <script type="text/javascript" src="js/jQuery.min.js"></script>
        <script type="text/javascript" src="js/bootstrap.min.js"></script>
        <script type="text/javascript" charset="utf-8" src="js/d3.min.js"></script>
        <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
        <link rel="stylesheet" type="text/css" href="css/webapp.css">
    </head>
    <body>
        <nav class="navbar navbar-inverse navbar-fixed-top">
            <div class="container">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="#">D3 Assignment</a>
                </div>
                <div id="navbar" class="collapse navbar-collapse">
                    <ul class="nav navbar-nav">
                        <li class="active"><a href="#">Scatter Plot</a></li>
                    </ul>
                </div><!--/.nav-collapse -->
            </div>
        </nav>
        <div class="container">
            <div class="starter-template">
                <h3>Bigdata Analytics Spring 2016 D3 Assignment</h3>
            </div>
            <div class="hover_header" style="color:white;">
                <h4>.</h4>
            </div>
            <div class="plot">
            </div>
            <div class="col col-md-12">
                <div class = "col col-md-3">
                    <label id="x_label"> X-Axis Label </label>
                    <select class="form-control" id="x_axis_dim">
                        <option value="" selected="true"> Select Dimension 1 </option>
                    </select>
                </div>
                <div class = "col col-md-3">
                    <label id="y_label"> Y-Axis Label </label>
                    <select class="form-control" id="y_axis_dim">
                        <option value="" selected="true"> Select Dimension 2 </option>
                    </select>
                </div>
            </div>
            <div class = "col col-md-12">
                <br/>
                <div class = "col col-md-3">
                    <label> Min Value </label>
                    <input type="number" class="form-control" id="min_value"/>
                </div>
                <div class = "col col-md-3">
                    <label> Max Value </label>
                    <input type="number" class="form-control" id="max_value"/>
                </div>
            </div>
            <div class="col col-md-12">
            </br>
                <div class="col col-md-6">
                    <div class="alert alert-danger" role="alert"  id="error_field" style="display:none;">
                    </div>
                </div>
            </div>
            <div class="col col-md-12">
                <div class="col col-md-3">
                    <button class="btn btn-primary" id="query_mpg" >Query MPG </buttin>
                </div>
            </div>
        </div><!-- /.container -->
    </body>

    <script type="text/javascript">
        $( document ).ready(function() {
            $("#error_field").hide();
            window.column_headings = [];
            window.car_name = [];
            window.mpg = [];
            window.cylinders = [];
            window.displacement = [];
            window.horsepower = [];
            window.weight = [];
            window.acceleration = [];
            window.model_year = [];
            window.origin = [];
            window.header_value_map = {};
            d3.csv("car.csv", function(data){
                if(column_headings.length==0){
                    column_headings = d3.keys(data[0]);
                    for(i=1;i<column_headings.length-1;i+=1){
                        d3.select("#x_axis_dim").append("option").attr("value",column_headings[i]).text(column_headings[i]);
                        d3.select("#y_axis_dim").append("option").attr("value",column_headings[i]).text(column_headings[i]);
                    }
                }
                var idx = 0;
                data.map(function(d){
                    window.car_name[idx] = d[column_headings[0]];
                    window.mpg[idx] = Number(d[column_headings[1]]);
                    window.cylinders[idx] = Number(d[column_headings[2]]);
                    window.displacement[idx] = Number(d[column_headings[3]]);
                    window.horsepower[idx] = Number(d[column_headings[4]]);
                    window.weight[idx]= Number(d[column_headings[5]]);
                    window.acceleration[idx] = Number(d[column_headings[6]]);
                    window.model_year[idx] = Number(d[column_headings[7]]);
                    window.origin[idx] = d[column_headings[8]];
                    idx+=1;
                });
            });
            window.header_value_map["mpg"] = window.mpg;
            window.header_value_map["cylinders"] = window.cylinders;
            window.header_value_map["displacement"] = window.displacement;
            window.header_value_map["horsepower"] = window.horsepower;
            window.header_value_map["weight"] = window.weight;
            window.header_value_map["acceleration"] = window.acceleration;
            window.header_value_map["model.year"] = window.model_year;
        });
        $("#query_mpg").click(function(){
            var error_occured = false;
            var error_message = "";
            if($("#x_axis_dim").val()==""){
                error_occured = true;
                error_message += "<p>Please enter X Axis Dimenstion!</p>";
            }
            if($("#y_axis_dim").val()==""){
                error_occured = true;
                error_message += "<p>Please enter Y Axis Dimenstion!</p>";
            }else if($("#x_axis_dim").val()==$("#y_axis_dim").val()){
                error_occured = true;
                error_message += "<p>The X and Y Dimensions cannot be the same!</p>";
            }
            if($("#min_value").val()==""){
                error_occured = true;
                error_message += "<p>Please enter min value!</p>";
            }
            if($("#max_value").val()==""){
                error_occured = true;
                error_message += "<p>Please enter max value!</p>";
            }else if(Number($("#max_value").val())<Number($("#min_value").val())){
                error_occured = true;
                error_message += "<p>Max value cannot be greater than Min value!</p>";
            }
            if(error_occured == true){
                $("#error_field").find("p").remove();
                $("#error_field").append(error_message);
                $("#error_field").show();
            }else{
                $("#error_field").find("p").remove();
                $("#error_field").hide();
                var data_values1 = window.header_value_map[$("#x_axis_dim").val()];
                var data_values2 = window.header_value_map[$("#y_axis_dim").val()];
                var test = []
                var mpg_min = Number($("#min_value").val());
                var mpg_max = Number($("#max_value").val());
                var min_max_idx = 0;
                for(j=0;j<data_values1.length;j++){
                    if (window.mpg[j] >= mpg_min && window.mpg[j] <= mpg_max){
                        test[min_max_idx] = [data_values1[j],data_values2[j],window.car_name[j]];
                        min_max_idx+=1;
                    }
                }
                var margin = {top:20, right:15, bottom:60, left:60},
                    width = 960 - margin.left-margin.right,
                    height = 500-margin.top-margin.bottom;
                var x = d3.scale.linear()
//                                .domain([d3.min([0,d3.min(data_values1)-1]), d3.max(data_values1)+1])
                                .domain([d3.max([0,d3.min(test,function(d){return d[0];})-1]), d3.max(test,function(d){return d[0];})+1])
                                .range([0,width]);
                var y = d3.scale.linear()
//                                .domain([d3.max([0,d3.min(data_values2)-1]), d3.max(data_values2)+1])
                                .domain([d3.max([0,d3.min(test,function(d){return d[1];})-1]), d3.max(test,function(d){return d[1];})+1])
                                .range([height,0]);
                var chart = d3.select("div.plot")
                                .append("svg:svg")
                                .attr("width",width+margin.right+margin.left)
                                .attr("height",height+margin.top+margin.bottom)
                                .attr("class","chart");
                var main = chart.append("g")
                                    .attr("transform",'translate('+margin.left+','+margin.top+')')
                                    .attr("width",width)
                                    .attr("height",height)
                                    .attr("class","main");
                var x_axis = d3.svg.axis()
                                    .scale(x)
                                    .orient("bottom");
                main.append('g')
                        .attr('transform','translate(0,'+height+')')
                        .attr("class","main axis date")
                        .call(x_axis)
                        .append("text")
                          .attr("class", "label")
                          .attr("x", width)
                          .attr("y", -8)
                          .style("text-anchor", "end")
                          .text($("#x_axis_dim").val()+"-->");

                var y_axis = d3.svg.axis()
                                    .scale(y)
                                    .orient("left");
                main.append('g')
                        .attr('transform','translate(0,0)')
                        .attr("class","main axis date")
                        .call(y_axis)
                        .append("text")
                          .attr("class", "label")
                          .attr("transform", "rotate(-90)")
                          .attr("y", 12)
                          .style("text-anchor", "end")
                          .text($("#y_axis_dim").val()+"-->");


                var g = main.append("svg:g");
                var tooltip = d3.select("div.plot").append("div")
                                .attr("class","tooltip")
                                .style("opacity",0);

                g.selectAll("scatter-dots")
                    .data(test)
                    .enter().append("svg:circle")
                            .attr("cx",function(d,a){return x(d[0]);})
                            .attr("cy",function(d,a){return y(d[1]);})
                            .attr("r",3)
                            .on("mouseover",function(d){
                                tooltip.transition()
                                        .duration(200)
                                        .style("opacity",0.9);
                                tooltip.html(d[2]).style("left",(d3.event.pageX+5)+"px")
                                .style("top",(d3.event.pageY-28)+"px");
                                d3.select(".hover_header").selectAll("h4").remove();
                                d3.select(".hover_header").append("h4").style("color","black").text(d[2]);
                            })
                            .on("mouseout",function(d){
                                tooltip.transition().duration(500)
                                        .style("opacity",0);
                                d3.select(".hover_header").selectAll("h4").remove();
                                d3.select(".hover_header").append("h4").text(".");
                            });
            }
        });
    </script>


</html>
